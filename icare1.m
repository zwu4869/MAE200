theta1 = 0.321298;
m1 = 0.2;
l1 = 1;
m2 = 0.1;
l2 = 0.5;
d2x = -0.7;
theta2 = 0.177919;
dtheta1 = -5.06567;
dtheta2 = -4.1403;
d2theta1 = 4.4;
d2theta2 = 0.9;  %data all from the swingup program
a42 = m1*l1*(d2theta1*sin(theta1)+dtheta1^2*cos(theta1));
a43 = m2*l2*(d2theta2*sin(theta2)+dtheta2^2*cos(theta2));
a45 = 2*m1*l1*dtheta1*sin(theta1);
a46 = 2*m2*l2*dtheta2*sin(theta2);
a52 = m1*l1*(9.8*cos(theta1)-d2x*sin(theta1));
a63 = m2*l2*(9.8*cos(theta2)-d2x*sin(theta2));
A = [0,0,0,1,0,0;0,0,0,0,1,0;0,0,0,0,0,1;0,-a42,-a43,0,-a45,-a46;0,a52,0,0,0,0;0,0,a63,0,0,0]; %A matrix on chapter 22
B = [0;0;0;1;0;0];
Q = diag([0.5 0.5 0.51 0.1 0.1 0.3]);
R = 0.00001;
[X1,K1,L1] = icare(A,B,Q,R,[],[],[])